<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Happy Birthday Golu! üíñ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #ffd6e7, #ffc2d6, #ffafcc, #ff9ebb);
      background-size: 400% 400%;
      animation: gradient 15s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
      color: #5a2b2b;
    }

    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .screen {
      text-align: center;
      padding: 30px;
      width: 100%;
      max-width: 500px;
      overflow-y: auto;
      max-height: 100vh;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin: 20px;
    }

    .hidden { 
      display: none; 
    }

    h1, h2 { 
      color: #d1477a; 
      text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 15px;
    }

    h1 {
      font-size: 2.2rem;
    }

    p { 
      color: #7c4d4d; 
      font-size: 1.1em; 
      margin: 10px 0 20px 0; 
      line-height: 1.5;
    }

    button {
      background: linear-gradient(to right, #ff6b6b, #ff8e8e);
      color: white;
      border: none;
      padding: 14px 25px;
      font-size: 1.1em;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
      margin: 10px;
    }

    button:hover { 
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(255, 107, 107, 0.6);
    }

    /* Angry Bird Level Indicator */
    #angryLevel {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.9);
      padding: 12px 18px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      z-index: 100;
      font-weight: bold;
    }

    #angryIcon {
      font-size: 1.8em;
      transition: transform 0.3s;
    }

    .angry-shake {
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      50% { transform: translateX(5px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }

    /* Welcome Screen Enhancements */
    .birthday-card {
      padding: 30px 20px;
    }

    .cake {
      font-size: 2.5em;
      margin: 25px auto;
      position: relative;
    }
    
    .cake-top {
      position: relative;
      font-size: 2.5em;
    }
    .candle {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.8em;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
     100% { transform: scale(1); }
    }

    .floating-hearts {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      font-size: 1.8em;
    }

    .floating-hearts span {
      position: absolute;
      animation: float 6s ease-in-out infinite;
      opacity: 0.8;
    }

    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
      50% { transform: translateY(-30px) rotate(20deg); opacity: 1; }
      100% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
    }

    /* Game Selection Cards */
    .games { 
      display: flex; 
      flex-direction: column; 
      gap: 20px; 
      margin: 20px 0;
    }
    
    .gameCard {
      background: linear-gradient(to right, rgba(255, 182, 193, 0.7), rgba(255, 215, 0, 0.7));
      color: #7c4d4d;
      padding: 20px;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .gameCard:hover { 
      transform: translateY(-5px) scale(1.02); 
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    /* Draggable List */
    .draggable-list { 
      list-style: none; 
      padding: 0; 
      margin: 25px 0; 
      max-height: 60vh; 
      overflow-y: auto; 
    }
    
    .draggable-list li {
      background: rgba(255, 228, 225, 0.9);
      margin: 10px 0;
      padding: 15px;
      border-radius: 12px;
      cursor: grab;
      font-size: 1.1em;
      transition: all 0.2s;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      /* Add touch-action to prevent default browser gestures */
      touch-action: none;
    }
    
    .draggable-list li:active {
      cursor: grabbing;
      transform: scale(1.02);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    }
    
    #lovePursuitGame {
      position: relative;
      width: 95%;
      max-width: 450px;
      height: 60vh;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin: 20px auto;
      border: 4px solid #d1477a;
      touch-action: none;
    }

    #gameCanvas {
      width: 100%;
      height: 100%;
    }

    #gameStats {
        display: flex;
        justify-content: space-around;
        width: 100%;
        margin-top: 10px;
        font-size: 1.2em;
        font-weight: bold;
        color: #d1477a;
    }

    /* Emoji Quiz */
    .quiz-item {
      background: rgba(255, 228, 225, 0.9);
      padding: 20px;
      border-radius: 15px;
      margin: 15px 0;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    .quiz-item input {
      width: 80%;
      padding: 12px 15px;
      border: 2px solid #ff9a9e;
      border-radius: 50px;
      font-size: 1em;
      margin-top: 10px;
      outline: none;
      transition: all 0.3s;
    }

    .quiz-item input:focus {
      border-color: #ff6b6b;
      box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.3);
    }

    /* Confetti */
    .confetti { 
      position: absolute; 
      width: 100%; 
      height: 100%; 
      top: 0;
      left: 0;
      pointer-events: none; 
      z-index: -1;
    }

    .confetti span {
      position: absolute;
      animation: fall 5s linear infinite;
      opacity: 0.8;
      font-size: 1.5em;
    }

    @keyframes fall {
      0% { transform: translateY(-10%) rotate(0deg); opacity: 1;}
      100% { transform: translateY(110%) rotate(360deg); opacity: 0;}
    }

    /* Result Screen */
    #result {
      background: rgba(255, 255, 255, 0.95);
      padding: 40px 30px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    #resultMsg {
      color: #d1477a;
      margin-bottom: 25px;
      white-space: pre-line;
      line-height: 1.6;
      font-size: 1.3em;
    }

    /* File upload styling */
    .file-upload {
      position: relative;
      display: inline-block;
      margin: 15px 0;
    }

    .file-upload input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-upload-label {
      display: inline-block;
      padding: 12px 20px;
      background: linear-gradient(to right, #ff6b6b, #ff8e8e);
      color: white;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }

    .file-upload-label:hover {
      background: linear-gradient(to right, #ff8e8e, #ff6b6b);
      transform: translateY(-2px);
    }
  </style>
</head>
<body>
  <!-- Angry Bird Level Indicator -->
  <div id="angryLevel">
    <span>Angry Level: </span>
    <span id="angryCount">0</span>
    <div id="angryIcon">üò°</div>
  </div>

  <!-- Welcome Screen -->
  <div id="welcome" class="screen">
    <div class="birthday-card">
      <h1>üíñ Happy Birthday Golu! üíñ</h1>
      <div class="cake">
        <div class="cake-top">üéÇ</div>
        <div class="candle">üïØÔ∏è</div>
      </div>
      <p>My dearest, every moment with you is special! ü•∞<br>Let's celebrate with some fun games! üíï</p>
      <button id="startBtn" class="pulse">Begin Our Adventure üöÄ</button>
    </div>
    <div class="confetti">
      <span style="left: 10%; animation-delay: 0s;">üéâ</span>
      <span style="left: 30%; animation-delay: 1s;">üéà</span>
      <span style="left: 50%; animation-delay: 2s;">‚ú®</span>
      <span style="left: 70%; animation-delay: 1.5s;">üíñ</span>
      <span style="left: 90%; animation-delay: 0.5s;">üéä</span>
    </div>
    <div class="floating-hearts">
      <span style="left: 20%; animation-delay: 0s;">üíñ</span>
      <span style="left: 50%; animation-delay: 2s;">üíï</span>
      <span style="left: 80%; animation-delay: 4s;">üíó</span>
    </div>
  </div>

  <!-- Game Selection -->
  <div id="gameSelect" class="screen hidden">
    <h2>Choose a Game üéÆ</h2>
    <div class="games">
      <div class="gameCard" id="game1">
        <h3>Memory Drag üì∏</h3>
        <p>Arrange our beautiful memories in order!</p>
      </div>
      <div class="gameCard" id="game2">
        <h3>Love's Pursuit üíñ</h3>
        <p>Find my face among the crowd! Choose wisely... üòâ</p>
      </div>
      <div class="gameCard" id="game3">
        <h3>Emoji Puzzles ‚ù§Ô∏è</h3>
        <p>Guess our special moments from emojis!</p>
      </div>
    </div>
  </div>

  <!-- Level 1: Memory Drag -->
  <div id="level1" class="screen hidden">
    <h2>Level 1: Arrange Our Memories üì∏</h2>
    <p>Drag the cards into the correct order of our beautiful journey together ü•∞</p>
    <ul id="memoryList" class="draggable-list"></ul>
    <button id="checkOrder">Check Our Love ‚úÖ</button>
  </div>

  <!-- Level 2: Love's Pursuit -->
  <div id="level2" class="screen hidden">
    <h2>Level 2: Love's Pursuit üíñ</h2>
    <p>Tap on my face! Don't tap on anyone else! üòâ</p>
    <div id="photoUploadSection">
      <div class="image-upload">
        <label>First, choose your photo:</label>
        <div class="file-upload">
          <label class="file-upload-label">Select My Photo üì∑</label>
          <input type="file" id="myPhotoUpload" accept="image/*">
        </div>
      </div>
      <button id="startGame2Btn" class="hidden">Start Game</button>
    </div>

    <div id="gameStats" class="hidden">
      <span>Score: <span id="gameScore">0</span></span>
      <span>Time: <span id="gameTime">30</span>s</span>
    </div>
    <div id="lovePursuitGame" class="hidden">
      <canvas id="gameCanvas"></canvas>
    </div>
  </div>

  <!-- Level 3: Emoji Puzzles -->
  <div id="level3" class="screen hidden">
    <h2>Level 3: Emoji Puzzles ‚ù§Ô∏è</h2>
    <p>Guess our special moments from these emoji clues! üíë</p>
    <div id="quizContainer"></div>
    <button id="finishGame">Finish üéâ</button>
  </div>

  <!-- Result -->
  <div id="result" class="screen hidden">
    <h1 id="resultMsg"></h1>
    <button onclick="resetGameAndPlayAgain()">Play Again üîÅ</button>
  </div>

  <script>
    // ---------- Global Variables ----------
    let angryCount = 0;
    let currentDragTarget = null; // For touch events

    // ---------- Screens ----------
    const welcome = document.getElementById("welcome");
    const gameSelect = document.getElementById("gameSelect");
    const level1 = document.getElementById("level1");
    const level2 = document.getElementById("level2");
    const level3 = document.getElementById("level3");
    const result = document.getElementById("result");
    const angryLevelElement = document.getElementById("angryCount");
    const angryIcon = document.getElementById("angryIcon");
    const startGame2Btn = document.getElementById("startGame2Btn");

    // ---------- Game Variables (for Love's Pursuit) ----------
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    let myPhotoUrl = null; 
    const otherLadyUrls = [
      'https://i.pinimg.com/originals/06/d8/e2/06d8e2c7a74035702a08006ae2adf876.jpg',
      'https://i.pinimg.com/736x/27/b5/10/27b5104e0fbd230a6e90e16b1edf660e.jpg',
      'https://preview.redd.it/koobpw1fdkt91.png?width=600&format=png&auto=webp&s=12df1368bc5468725fc324f965ac73aa61211688',
      'https://i1.sndcdn.com/artworks-lpXRGXnYghR3HzU4-Jye7hA-t1080x1080.jpg'
    ]; 
    const images = [];
    let gameScore = 0;
    let gameTime = 30;
    let lastTime = 0;
    let spawnTimer = 0;
    let gameInterval;
    let myPhoto = new Image();
    let otherLadyPhotos = [];

    // ---------- Start Game ----------
    document.getElementById("startBtn").addEventListener("click", () => {
      welcome.classList.add("hidden");
      gameSelect.classList.remove("hidden");
    });

    // ---------- Game Selection ----------
    document.getElementById("game1").onclick = () => {
      gameSelect.classList.add("hidden");
      startLevel1();
    }
    document.getElementById("game2").onclick = () => {
      gameSelect.classList.add("hidden");
      startLevel2();
    }
    document.getElementById("game3").onclick = () => {
      gameSelect.classList.add("hidden");
      startLevel3();
    }

    // ---------- Angry Bird Functions ----------
    function updateAngryLevel(increase = true) {
      if (increase) {
        angryCount++;
      } else {
        angryCount = Math.max(0, angryCount - 1);
      }
      
      angryLevelElement.textContent = angryCount;
      
      // Add animation to the angry icon
      angryIcon.classList.add('angry-shake');
      setTimeout(() => {
        angryIcon.classList.remove('angry-shake');
      }, 500);
      
      // Change icon based on anger level
      if (angryCount >= 5) {
        angryIcon.textContent = 'üò†';
      } else if (angryCount >= 10) {
        angryIcon.textContent = 'üò°';
      } else if (angryCount >= 15) {
        angryIcon.textContent = 'ü§¨';
      } else {
        angryIcon.textContent = 'üò°';
      }
    }

    // ---------- LEVEL 1: Memory Drag ----------
    const memories = [
      "Proposal üíç",
      "First Date üçΩÔ∏è",
      "Bandstand (Bandra) üåä", 
      "His Birthday üéÇ",
      "Girgaon Chowpatty Kiss üíã",
      "Haji Ali & Mahalaxmi üïå",
      "Central Park Walk üö∂‚Äç‚ôÄÔ∏è",
      "Matheran (1st Time) üèûÔ∏è",
      "Borivali National Park üêÖ",
      "Dadar Chowpatty üèñÔ∏è",
      "ISKCON & Zoo üêò",
      "Wonders Park üé°",
      "Matheran (2nd Time) üêé",
      "Snow World ‚ùÑÔ∏è",
      "Bike Ride üèçÔ∏è",
      "Nature Trail üåø"
    ];

    function startLevel1(){
      level1.classList.remove("hidden");
      const list = document.getElementById("memoryList");
      list.innerHTML = "";
      let shuffled = [...memories].sort(() => Math.random() - 0.5);
      
      shuffled.forEach(mem => {
        const li = document.createElement("li");
        li.textContent = mem;
        li.draggable = true;
        list.appendChild(li);
      });
      
      initDragAndDrop(list);

      document.getElementById("checkOrder").onclick = () => {
        const items = [...list.querySelectorAll("li")].map(li => li.textContent);
        if (items.join() === memories.join()) {
          updateAngryLevel(false);
          showResult(true);
        } else {
          updateAngryLevel(true); // Increase angry level on failure
          showAngry();
        }
      }
    }

    function initDragAndDrop(container) {
      let draggedItem = null;

      container.querySelectorAll('li').forEach(item => {
        // Mouse events
        item.addEventListener('dragstart', function() {
          draggedItem = this;
          setTimeout(() => this.style.opacity = '0.5', 0);
        });

        item.addEventListener('dragend', function() {
          draggedItem = null;
          this.style.opacity = '1';
        });

        item.addEventListener('dragover', function(e) {
          e.preventDefault();
        });

        item.addEventListener('dragenter', function(e) {
          e.preventDefault();
          this.style.backgroundColor = '#ffd1dc';
        });

        item.addEventListener('dragleave', function() {
          this.style.backgroundColor = '#ffe4e1';
        });

        item.addEventListener('drop', function(e) {
          e.preventDefault();
          this.style.backgroundColor = '#ffe4e1';
          if (this !== draggedItem) {
            container.insertBefore(draggedItem, this.nextSibling);
          }
        });
        
        // Touch events
        item.addEventListener('touchstart', function(e) {
          e.preventDefault();
          draggedItem = this;
          this.style.opacity = '0.5';
          this.style.transform = 'scale(1.05)';
        });
        
        item.addEventListener('touchmove', function(e) {
          e.preventDefault();
          const touch = e.touches[0];
          const target = document.elementFromPoint(touch.clientX, touch.clientY);
          
          if (target && target.tagName === 'LI' && target.parentElement === container) {
            if (currentDragTarget && currentDragTarget !== target) {
              currentDragTarget.style.backgroundColor = '#ffe4e1';
            }
            currentDragTarget = target;
            currentDragTarget.style.backgroundColor = '#ffd1dc';
          } else {
            if (currentDragTarget) {
              currentDragTarget.style.backgroundColor = '#ffe4e1';
              currentDragTarget = null;
            }
          }
        });

        item.addEventListener('touchend', function(e) {
          if (currentDragTarget && currentDragTarget !== draggedItem) {
            container.insertBefore(draggedItem, currentDragTarget.nextSibling);
          }
          this.style.opacity = '1';
          this.style.transform = 'none';
          if (currentDragTarget) {
            currentDragTarget.style.backgroundColor = '#ffe4e1';
          }
          draggedItem = null;
          currentDragTarget = null;
        });
      });
    }

    // ---------- LEVEL 2: Love's Pursuit ----------
    const photoUploadInput = document.getElementById("myPhotoUpload");
    
    // A separate function to handle starting the canvas game
    function startGameCanvas() {
        document.getElementById("photoUploadSection").classList.add("hidden");
        document.getElementById("gameStats").classList.remove("hidden");
        document.getElementById("lovePursuitGame").classList.remove("hidden");
        
        const gameContainer = document.getElementById("lovePursuitGame");
        canvas.width = gameContainer.clientWidth;
        canvas.height = gameContainer.clientHeight;
        
        // Load all images and then start the game loop
        let imagesLoaded = 0;
        const totalImagesToLoad = 1 + otherLadyPhotos.length;

        function checkAllImagesLoaded() {
            imagesLoaded++;
            if (imagesLoaded === totalImagesToLoad) {
                // All images are loaded, start the game
                gameInterval = setInterval(() => {
                    gameTime--;
                    updateStats();
                }, 1000);

                lastTime = performance.now();
                requestAnimationFrame(gameLoop);
            }
        }
        
        myPhoto.onload = checkAllImagesLoaded;
        myPhoto.src = myPhotoUrl;
        
        otherLadyPhotos = otherLadyUrls.map(url => {
          const img = new Image();
          img.onload = checkAllImagesLoaded;
          img.src = url;
          return img;
        });
        
        gameScore = 0;
        gameTime = 30;
        images.length = 0;
        
        const scoreDisplay = document.getElementById("gameScore");
        const timeDisplay = document.getElementById("gameTime");
        
        // Add a function to update the score and time
        function updateStats() {
          scoreDisplay.textContent = gameScore;
          timeDisplay.textContent = gameTime;
        }

        // Game loop
        function gameLoop(timestamp) {
          if (gameTime <= 0) {
            // Time's up! Check if they won.
            if (gameScore >= 10) { // Winning score
              updateAngryLevel(false);
              showResult(true);
            } else {
              updateAngryLevel(true);
              showAngry();
            }
            return;
          }

          const elapsed = timestamp - lastTime;
          lastTime = timestamp;

          spawnTimer += elapsed;
          if (spawnTimer > 1000) { // Spawn a new image every second
            spawnImage();
            spawnTimer = 0;
          }

          ctx.clearRect(0, 0, canvas.width, canvas.height);

          for (let i = images.length - 1; i >= 0; i--) {
            const image = images[i];
            image.update();
            image.draw();

            // Remove image if it goes off screen
            if (image.y < -image.size) {
              images.splice(i, 1);
            }
          }
          requestAnimationFrame(gameLoop);
        }
        
        // Spawn a new image
        function spawnImage() {
          const isCorrect = Math.random() < 0.7; // 70% chance to be your photo
          const imageType = isCorrect ? myPhoto : otherLadyPhotos[Math.floor(Math.random() * otherLadyPhotos.length)];
          const x = Math.random() * (canvas.width - 50);
          const y = canvas.height + 20;
          images.push(new Photo(x, y, imageType, isCorrect));
        }

        // Handle clicks/taps
        function handleInteraction(e) {
          const rect = canvas.getBoundingClientRect();
          const clientX = e.clientX || e.touches[0].clientX;
          const clientY = e.clientY || e.touches[0].clientY;
          const x = clientX - rect.left;
          const y = clientY - rect.top;

          for (let i = images.length - 1; i >= 0; i--) {
            const image = images[i];
            if (x > image.x && x < image.x + image.size && y > image.y && y < image.y + image.size) {
              if (image.isCorrect) {
                gameScore++;
                images.splice(i, 1);
                updateStats();
              } else {
                // Game over!
                updateAngryLevel(true);
                showAngry();
                images.length = 0; // Clear images
                clearInterval(gameInterval);
                return;
              }
            }
          }
        }

        canvas.addEventListener("click", handleInteraction);
        canvas.addEventListener("touchstart", handleInteraction);

    }

    class Photo {
      constructor(x, y, image, isCorrect) {
        this.x = x;
        this.y = y;
        this.size = 50;
        this.image = image;
        this.isCorrect = isCorrect;
        this.speed = Math.random() * 0.5 + 0.5;
      }

      update() {
        this.y -= this.speed;
      }

      draw() {
        ctx.drawImage(this.image, this.x, this.y, this.size, this.size);
      }
    }
    
    function startLevel2() {
      level2.classList.remove("hidden");
      // Set up file upload listener
      photoUploadInput.onchange = handleMyPhotoUpload;
      // Hide game elements until photo is uploaded
      document.getElementById("gameStats").classList.add("hidden");
      document.getElementById("lovePursuitGame").classList.add("hidden");
      startGame2Btn.classList.add("hidden");
      // Add the click listener to the start button for Level 2
      startGame2Btn.onclick = startGameCanvas;
    }

    function handleMyPhotoUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          myPhotoUrl = e.target.result;
          startGame2Btn.classList.remove("hidden");
        };
        reader.readAsDataURL(file);
      }
    }
    
    // ---------- LEVEL 3: Emoji Puzzles ----------
    function startLevel3(){
      level3.classList.remove("hidden");
      const emojiPuzzles = [
        {q: "üåπüöâüìñ", a: ["proposal","propose", "station", "physics", "exam"]},
        {q: "üçΩÔ∏èüíã1Ô∏è‚É£", a: ["first date", "date"]},
        {q: "üé°üò®üôè", a: ["wonders park", "park", "rides", "om", "namah", "shivay"]},
        {q: "üèûÔ∏èüêíüçåüöÇ", a: ["matheran", "monkeys", "toy", "train"]},
        {q: "üèñÔ∏èüì∏üçîüß£", a: ["beach","dadar", "scarf"]},
        {q: "üïåüåâüö∂‚Äç‚ôÄÔ∏è", a: ["haji ali", "ali", "mahalaxmi", "walk"]},
        {q: "üêÖüå≥üì∑", a: ["borivali", "national park", "park"]},
        {q: "üêíü•≠üêÆ", a: ["zoo", "iskcon"]},
        {q: "‚ùÑÔ∏èüõ∑üòÇ", a: ["snow world", "world", "sled", "sliding"]},
        {q: "üåßÔ∏èüèçÔ∏è‚õ≤", a: ["bike ride", "ride", "rain", "mandir", "waterfall"]},
        {q: "üåøüì∏üòä", a: ["nature trail", "trail"]},
        {q: "üéÇüéâüéà", a: ["birthday", "surprise"]}
      ];
      
      const container = document.getElementById("quizContainer");
      container.innerHTML = "";
      
      emojiPuzzles.forEach((item, index) => {
        const quizItem = document.createElement("div");
        quizItem.className = "quiz-item";
        quizItem.innerHTML = `
          <p>${item.q}</p>
          <input type="text" placeholder="Your answer...">
          <div class="correct-answer" style="display: none; color: #7c4d4d; font-size: 0.9em; margin-top: 5px;">Possible answers: ${item.a.join(", ")}</div>
        `;
        container.appendChild(quizItem);
      });

      document.getElementById("finishGame").onclick = () => {
        const inputs = container.querySelectorAll("input");
        let allCorrect = true;
        
        inputs.forEach((input, index) => {
          const userAnswer = input.value.trim().toLowerCase();
          const correctAnswers = emojiPuzzles[index].a;
          
          // Check if user's answer contains any of the correct keywords
          const isCorrect = correctAnswers.some(answer => 
            userAnswer.includes(answer.toLowerCase())
          );
          
          if (!isCorrect) {
            allCorrect = false;
            input.style.borderColor = "#ff6b6b";
            input.nextElementSibling.style.display = "block";
          } else {
            input.style.borderColor = "#7cff7c";
            input.nextElementSibling.style.display = "none";
          }
        });
        
        if (allCorrect) {
          updateAngryLevel(false);
          showResult(true);
        } else {
          updateAngryLevel(true); // Increase angry level on failure
          showAngry();
        }
      };
    }

    // ---------- Result / Angry ----------
    function showAngry(){
      result.classList.remove("hidden");
      document.getElementById("resultMsg").innerHTML = "üò° Angry Bird is getting angrier after seeing this!\n\nAngry Level: " + angryCount;
      level1.classList.add("hidden"); 
      level2.classList.add("hidden"); 
      level3.classList.add("hidden");
      clearInterval(gameInterval); // Stop game timer
    }

    function showResult(win){
      result.classList.remove("hidden");
      
      if (win) {
        document.getElementById("resultMsg").innerHTML = 
          "üéâ Yay! You completed this challenge! üíï\n\n" +
          "Impressed üòâ! \n\n" +
          "I love you more than anything! üíñ";
      } else {
        document.getElementById("resultMsg").innerHTML = 
          "üò° Angry Bird is getting angrier after seeing this!\n\n" +
          "Angry Level: " + angryCount;
      }
      
      level1.classList.add("hidden"); 
      level2.classList.add("hidden"); 
      level3.classList.add("hidden");
      clearInterval(gameInterval); // Stop game timer
    }

    // New function to reset the game state without reloading the page
    function resetGameAndPlayAgain() {
        result.classList.add("hidden");
        gameSelect.classList.remove("hidden");
        // Reset the game variables
        myPhotoUrl = null;
        gameScore = 0;
        gameTime = 30;
        images.length = 0;
        lastTime = 0;
        spawnTimer = 0;
    }

    // Initialize floating hearts
    function initHearts() {
      const heartsContainer = document.querySelector('.floating-hearts');
      for (let i = 0; i < 5; i++) {
        const heart = document.createElement('span');
        heart.innerHTML = 'üíñ';
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.animationDelay = `${Math.random() * 5}s`;
        heartsContainer.appendChild(heart);
      }
    }

    // Initialize when page loads
    window.onload = function() {
      initHearts();
    };
  </script>
</body>
</html>
